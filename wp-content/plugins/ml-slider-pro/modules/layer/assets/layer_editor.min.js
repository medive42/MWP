!function(e){e(function(){var a={checkSaveRequest:function(){jQuery.active<1&&e(".spinner").hide(),setTimeout(a.checkSaveRequest,1e3)},checkForSelectedLayer:function(){0==e(".metaslider-active").length&&alert(metasliderpro.noLayerSelected)},createNewLayer:function(){e(".metaslider-active").removeClass("metaslider-active");var t=Math.floor(999999999*Math.random()+1),i=e("<div class='content' id='layer_content_"+t+"'>"+metasliderpro.newLayer+"</div>").css({color:"white",padding:"5px"}).attr("data-padding","5"),n=e("<div class='ms_content_wrap' />").css({height:"100%",background:"rgba(142, 142, 142, 0.50)"}).html(i),o=e("<div class='animation_out animated disabled'/>").attr("data-animation","disabled").attr("data-animation-delay","0").css({height:"100%",width:"100%"}).html(n),d=e("<div class='animation_in animated disabled' />").attr("data-animation","disabled").attr("data-animation-delay","0").css({width:"100%",height:"100%"}).html(o),r=e("<div class='layer metaslider-active' />").css({width:"120px",height:"40px",top:"5px",left:"5px",position:"absolute"}).attr("data-width","120").attr("data-height","40").html(d);e("#htmlOverlay").append(r),a.makeLayerEditable(r)},updateLayerAnimationDelay:function(){var a=1e3*parseFloat(e("#animation_in_delay").val()),t=1e3*parseFloat(e("#animation_out_delay").val()),i=t+a;e(".metaslider-active .animation_in").attr("data-animation-delay",e("#animation_in_delay").val(),10).attr("style","animation-delay: "+a+"ms; -moz-animation-delay: "+a+"ms; -webkit-animation-delay: "+a+"ms;"),e(".metaslider-active .animation_out").attr("data-animation-delay",e("#animation_out_delay").val(),10).attr("style","animation-delay: "+i+"ms; -moz-animation-delay: "+i+"ms; -webkit-animation-delay: "+i+"ms;")},save:function(t){e(".spinner").show(),e("#"+t).val(a.get_html()),e("#ms-save").click()},save_on_close:function(t){var i=e("#"+t).val(),n=a.get_html();i!=n&&confirm(metasliderpro.saveChanges)&&a.save(t)},render:function(t,n,o,d){var r=e("<input type='text' id='layerBgColor' />"),l=e("<div class='layer_editor' />"),s=(e("<div />"),e(e("#"+n).val())),c=e("<button class='button primary addLayer'>").html(metasliderpro.newLayer).bind("click",function(){a.createNewLayer()}),p=e("<span class='spinner'></span>"),m=e("<button class='button secondary save'>").html(metasliderpro.save).bind("click",function(){a.save(n)}),u=e("<div />").attr("class","container").css("position","relative").css("overflow","auto"),h=e("<div />").attr("id","htmlOverlay").css({position:"absolute",top:"0",left:"0",width:o+"px",height:d+"px"}).html(s),v=e("<img class='slide' />").attr("src",t).attr("width",o).attr("height",d).css("display","block"),g=e("<div class='toolbar_wrapper' />"),f=e("<div id='wysiwyg_buttons' />"),b=e("<div id='animation_toolbar'><b>"+metasliderpro.animation+":</b> </div>"),y=e("<div id='style_toolbar'></div>"),_=e("<input id='layer_padding' type='number' step='1' min='0' max='99' value='0' size='3' />"+metasliderpro.px+"&nbsp;").on("change",function(){e(".metaslider-active .content").attr("data-padding",e(this).val()),e(".metaslider-active .content").css("padding",e(this).val()+"px")}),w=e("<input type='checkbox' />").attr("checked","checked").change(function(){e(this).is(":checked")?e(".layer").each(function(){e(this).resizable({grid:5}).draggable({grid:[5,5]})}):e(".layer").each(function(){e(this).resizable({grid:!1}).draggable({grid:!1})})}),k=e("<label id='snapToGrid'>"+metasliderpro.snapToGrid+"</label>").css("float","right").append(w),I=[" ","flash","bounce","shake","tada","swing","wobble","wiggle","pulse","flip","flipInX","flipInY","fadeIn","fadeInUp","fadeInDown","fadeInLeft","fadeInRight","fadeInUpBig","fadeInDownBig","fadeInLeftBig","fadeInRightBig","bounceIn","bounceInDown","bounceInUp","bounceInLeft","bounceInRight","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight","lightSpeedIn","hinge","rollIn"],O=[" ","flash","bounce","shake","tada","swing","wobble","wiggle","pulse","flip","rollOut","lightSpeedOut","rotateOut","rotateOutDownLeft","rotateOutDownRight","rotateOutUpLeft","rotateOutUpRight","bounceOut","bounceOutDown","bounceOutUp","bounceOutLeft","bounceOutRight","flipOutY","flipOutX","fadeOut","fadeOutUp","fadeOutDown","fadeOutLeft","fadeOutRight","fadeOutUpBig","fadeOutDownBig","fadeOutLeftBig","fadeOutRightBig","hinge"],L=e("<input id='animation_in_delay' type='number' max='99' min='0' step='0.1' size='3' value='0' />").change(function(){a.checkForSelectedLayer(),a.updateLayerAnimationDelay()}),x=e("<input id='animation_out_delay' type='number' max='99' min='0' step='0.1' size='3' value='0' />").change(function(){a.checkForSelectedLayer(),a.updateLayerAnimationDelay()}),C=e("<select id='animation_in' />").change(function(){a.checkForSelectedLayer();var t=e("#animation_in :selected").val(),i=e(".metaslider-active .animation_in");i.removeClass(i.data("animation")),i.addClass(t),i.attr("data-animation",t)}),D=e("<select id='animation_out' />").change(function(){a.checkForSelectedLayer();var t=e("#animation_out :selected").val(),i=e(".metaslider-active .animation_out");i.removeClass(i.data("animation")),i.addClass(t),i.attr("data-animation",t)});for(i=0;i<I.length;i++)e("<option/>").val(I[i]).html(I[i]).appendTo(C);for(i=0;i<O.length;i++)e("<option/>").val(O[i]).html(O[i]).appendTo(D);return h.after(v),b.append(metasliderpro.wait).append(L).append(metasliderpro.secondsAnd).append(C).append(metasliderpro.thenWait).append(x).append(metasliderpro.secondsAnd).append(D),y.append("<b>"+metasliderpro.padding+":</b>").append(_).append("&nbsp;&nbsp;<b>"+metasliderpro.background+":</b>").append(r).append(k),g.append(f).append(b).append(y),r.spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,change:function(a){e(".metaslider-active .content_wrap, .metaslider-active .ms_content_wrap").css("background-color",a.toRgbString())}}),u.append(h).append(v),l.append(c).append(m).append(p).append(g).append(u)},get_html:function(){var a=e("#htmlOverlay").clone();return e(".layer",a).each(function(){var a=e(this),t=e(".content",a),i=t.attr("id");t.html(CKEDITOR.instances[i].getData()),e(".drag_handle",a).remove(),e(".delete_button",a).remove(),t.removeAttr("tabindex"),t.removeAttr("spellcheck"),t.removeAttr("contenteditable"),t.removeAttr("title"),t.removeAttr("aria-describedby"),t.removeAttr("role"),t.removeAttr("aria-label"),t.removeClass("cke_editable_inline cke_contents_ltr cke_show_borders cke_editable cke_focus"),a.removeClass("ui-resizable"),a.removeClass("ui-draggable"),a.removeClass("metaslider-active"),a.css("cursor",""),a.css("background-position",""),a.css("background-repeat",""),e(".ui-resizable-handle",a).remove()}),a.html()},init:function(){CKEDITOR.disableAutoInline=!0,CKEDITOR.config.allowedContent=!0,CKEDITOR.config.language="en",a.checkSaveRequest(),e(".layer").each(function(){a.makeLayerEditable(e(this))})},makeLayerEditable:function(a){var t=e("<div class='delete_button'>X</div>").click(function(){confirm(metasliderpro.areYouSure)&&a.remove()});a.prepend(t).append("<div class='drag_handle'>X</div>").resizable({handles:"se",containment:"#htmlOverlay",grid:5,stop:function(a,t){var i=t.size.width;e(this).attr("data-width",i);var n=t.size.height;e(this).attr("data-height",n)}}).draggable({containment:"#htmlOverlay",handle:".drag_handle",grid:[5,5],stop:function(a,t){var i=t.position.top;e(this).attr("data-top",i);var n=t.position.left;e(this).attr("data-left",n)}}),e(".content",a).attr("contenteditable","true").focus(function(){e(".metaslider-active").removeClass("metaslider-active"),e(this).parent().parent().parent().parent().addClass("metaslider-active"),e("#animation_out_delay").val(e(".animation_out",a).data("animation-delay")),e("#animation_in_delay").val(e(".animation_in",a).data("animation-delay")),e("#animation_out").val(e(".animation_out",a).data("animation")),e("#animation_in").val(e(".animation_in",a).data("animation")),e("#layer_padding").val(e(".content",a).data("padding")),e("#layerBgColor").spectrum("set",e(".content_wrap, .ms_content_wrap",a).css("background-color"))}),CKEDITOR.inline(e(".content",a).attr("id"))}};e(".metaslider").on("metaslider/attachment/updated",".slide",function(a,t){t.img_url&&e(this).find(".openLayerEditor").data("thumb",t.img_url)}),e(".metaslider table#metaslider-slides-list").on("metaslider/size-has-changed",function(a,t){e(".openLayerEditor").data("width",t.width).data("height",t.height)}),e(".openLayerEditor").live("click",function(t){t.preventDefault(),e("#colorbox").removeAttr("tabindex");var i=e(this);if(!i.data("height"))return alert(metasliderpro.setHeight);if(!i.data("width"))return alert(metasliderpro.setWidth);var n=parseInt(i.data("width"),10)<850?850:parseInt(i.data("width"),10),o=i.closest(".slide").find(".update-image").data("cropped-img-url")||i.data("thumb");jQuery.colorbox({html:a.render(o,i.data("editor_id"),i.data("width"),i.data("height")),transition:"elastic",innerHeight:parseInt(i.data("height"),10)+152+"px",innerWidth:n+"px",scrolling:!0,className:"layerEditorCbox",onCleanup:function(){a.save_on_close(i.data("editor_id"))},onComplete:function(){a.init(),"rtl"==jQuery("html").attr("dir")&&"0px"==jQuery("#colorbox").css("left")&&jQuery("#colorbox").css("left","auto")}})})})}(jQuery);